# citrix-netscaler-zabbix
Monitoring Citrix NetScaler from zabbix

# citrix-netscaler-zabbix
Monitoring Citrix NetScaler from zabbix
Мониторинг citrix NetScaler Load Balancing

Мониторинг citrix NetScaler Gateway

Технология Citrix NetScaler чаще всего применяется в кластерном исполнении, когда устанавливаются две ноды, объединяются в один кластер, и на основе кластера создаются вируальные сущности высокой доступности, которые в свою очередь нужно как то контролировать.

Шаблон Template_NetScaler.xml - базовый шаблон который подключается к нодам, шаблон показывает классические данные о здоровье

шаблон Template_NetScaler_VPX_LB_DNS.xml - расширенный, подключается к нодам, шаблон показывает динамику работы DNS функционала NS

Внутри NetScaler на основе кластера, имеется возможность создавать виртуальные сервера

Я разработал механизм, который позволяет в мониторинге создать один объект с именем таким же как виртуальный сервер, и получать информацию об этом виртуальном объекте с обоих нод кластера. 
Механизм реализует следующие функции:
- получает список виртуальных сущностей с обоих нод кластера
- получает список серверов из мониторинга, которые подключены к шаблону
- определяет сущности которых в мониторинге нет и нужно создать
- определяет сущности которые есть в мониторинге, но нет на NS нодах, помечает их к удалению
- Создает сам узлы в мониторинге, в заданной хост группе
- Удаляет сам узлы, которые были ранее помечены на удаление
- Получает все метрики шаблона, и хостов, которые приленкованны
- Анализирует правильность их линковки 
- Исправляет подключение к тому или иному интерфейсу, чтобы съем данных происходил в правильном режиме

Речь идет о скриптах  ns-vpx-had-vServer.pl   и    ns-vpx-lb-vserver.pl

До начала запуска скриптов:
- Нужно позаботится об установке зависимостей и пакетов
- Нужно создать в мониторинге новое преобразование значений -> фото NetScaler_ha_PeerState
- Импортировать шаблоны
- Создать хост группу в мониторинге
- убедится, что NS ноды отдают информацию по snmp
- Убедится в наличии сетевой связанности
- Отредактировать скрипты под ваши сетевые параметры и доступ в мониторинг

Шаблоны   Template_NetScaler_VPX_HAD_vServer.xml    и   Template_NetScaler_VPX_LB_vServer.xml  используются только в ns-vpx-had-vServer.pl и ns-vpx-lb-vserver.pl 

В шаблонах Template_NetScaler_VPX_HAD_vServer.xml и Template_NetScaler_VPX_LB_vServer.xml нужно поправить некоторые макроссы:
{$NODE_1} и {$NODE_2}  IP адреса нод

{$NODE_1_NAME} и {$NODE_2_NAME} понятное имя нод, можно FQDN можно и иное понятное для вас имя

Template_NetScaler_VPX_LB_vServer

  {$NODE_1} 172.16.0.1
  {$NODE_1_NAME} nsvpxlb-01
  {$NODE_2} 172.16.0.2
  {$NODE_2_NAME}  nsvpxlb-02

Template_NetScaler_VPX_HAD_vServer

  {$NODE_1} 172.16.10.1
  {$NODE_1_NAME}  NSVPXHA-01
  {$NODE_2} 172.16.10.2
  {$NODE_2_NAME}  NSVPXHA-02

